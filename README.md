# mqtt_samples

IoTで使われるMQTT通信の基本的なサンプルコードです。

## publisher.py
Paho MQTTクライアントライブラリを使用してMQTTブローカに接続し、特定のトピックにメッセージを発行します。

スクリプトで使用されるブローカは 'broker.emqx.io' で、デフォルトのポートは1883です。スクリプトは、プレフィックス 'python-mqtt-' と0から1000までのランダムな数値を使用してクライアントIDを生成します。スクリプトで使用されるトピックは 'python/mqtt' です。

 `connect_mqtt()` 関数は、ブローカへの接続を設定し、クライアントID、ユーザー名、およびパスワードを設定します。接続が確立されると、 `on_connect` 関数が呼び出されます。

 `publish()` 関数は、メッセージを発行するための無限ループを作成し、1秒ごとに "messages: [メッセージの数]" というメッセージを作成して、指定されたトピックに発行します。発行が成功した場合、メッセージが出力されます。発行に失敗した場合、エラーメッセージが出力されます。

最後に、 `run()` 関数は、クライアントを接続し、 `publish()` 関数を実行してメッセージを発行します。

## subscriber.py
Paho MQTTクライアントライブラリを使用してMQTTブローカに接続し、指定されたトピックをサブスクライブしてメッセージを受信するためのシンプルなMQTTサブスクライバの実装です。

ブローカは 'broker.emqx.io' を使用し、デフォルトのポート番号は1883です。スクリプトは、プレフィックス 'python-mqtt-' と0から100までのランダムな数値を使用してクライアントIDを生成します。トピックは 'python/mqtt' に設定されます。

`connect_mqtt()` 関数は、MQTTブローカに接続するためのクライアントを生成します。クライアントには、クライアントIDとともにユーザー名とパスワードが設定されます。接続が確立されると、 `on_connect` 関数が呼び出されます。

`subscribe()` 関数は、指定されたトピックをサブスクライブし、新しいメッセージが受信されたときに呼び出されるコールバック関数を設定します。新しいメッセージが受信されると、 `on_message` 関数が呼び出され、メッセージとトピックが出力されます。

最後に、 `run()` 関数は、クライアントを接続し、 `subscribe()` 関数を実行してトピックをサブスクライブします。 `client.loop_forever()` 関数は、接続が維持され、新しいメッセージが受信されるたびにコールバック関数が呼び出されるようにします。
